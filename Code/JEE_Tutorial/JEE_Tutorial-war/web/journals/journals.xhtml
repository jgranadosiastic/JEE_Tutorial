<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../templates/simple.xhtml"
			 xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
			 xmlns:p="http://primefaces.org/ui"
			 xmlns:h="http://xmlns.jcp.org/jsf/html"
			 xmlns:f="http://xmlns.jcp.org/jsf/core"
			 xmlns:jsf="http://xmlns.jcp.org/jsf">

	<ui:define name="title">
		Journals
	</ui:define>

	<ui:define name="content">
		<h2>Journals
			<p:commandLink styleClass="btn btn-success" onclick="PF('dlgEdit').show();">
				<span class="glyphicon glyphicon-plus-sign"></span> New
			</p:commandLink>
		</h2>

		<h:form id="journalSearch">
			<fieldset>
				<legend>Search</legend>
				<div class="row">
					<div class="form-group col-sm-4">
						<p:outputLabel for="name" value="Journal Name:" />
						<p:inputText id="name" styleClass="form-control" pt:placeholder="Journal Name"
								   value="#{journalsView.nameSearchCriteria}"/>
					</div>
					<div class="form-group  col-sm-4">
						<p:outputLabel for="tag" value="Tag:" />
						<p:inputText id="tag" styleClass="form-control" pt:placeholder="Tag"
								   value="#{journalsView.tagSearchCriteria}"/>
					</div>
				</div>
				<div class="row">
					<div class="form-group">
						<p:commandButton styleClass="btn btn-primary pull-right" update=":journalTable" 
									  value="Search"
									  action="#{journalsView.searchJournals()}"/>
					</div>
				</div>
			</fieldset>
		</h:form>

		<p:dataTable id="journalTable" var="journal" value="#{journalsView.journals}"
				   reflow="true">
			<p:column headerText="#">
				<h:outputText value="#{journal.idJournal}" />
			</p:column>

			<p:column headerText="Journal Name">
				<h:outputText value="#{journal.name}" />
			</p:column>

			<p:column headerText="Tag">
				<h:outputText value="#{journal.tags}" />
			</p:column>

			<p:column headerText="About">
				<h:outputText value="#{journal.about}" />
			</p:column>

			<p:column headerText="Owner">
				<h:outputText value="#{journal.ownerProfile.firstName} #{journal.ownerProfile.lastName}" />
			</p:column>

			<p:column headerText="Is Active">
				<h:outputText value="#{journal.active}" />
			</p:column>

			<p:column headerText="Publications">
				<p data-placement="top" data-toggle="tooltip" title="Publications">
					<span>#{journal.publicationsCount}</span>
					<button jsf:outcome="publications" styleClass="btn btn-primary btn-xs">
						<span class="glyphicon glyphicon-folder-open"></span>
						<f:param name="idJournal" value="#{journal.idJournal}"/>
					</button>
				</p>
			</p:column>

			<p:column headerText="Edit">
				<p data-placement="top" data-toggle="tooltip" title="Edit">
					<p:commandLink styleClass="btn btn-primary btn-xs" oncomplete="PF('dlgEdit').show();"
								update=":#{p:component('dlgEdit')}">
						<f:setPropertyActionListener value="#{journal}" target="#{journalsView.currentJournal}"/>
						<span class="glyphicon glyphicon-pencil"></span>
					</p:commandLink>
				</p>
			</p:column>

			<p:column headerText="Delete">
				<p data-placement="top" data-toggle="tooltip" title="Delete">
					<p:commandLink styleClass="btn btn-danger btn-xs"
								actionListener="#{journalsView.deleteJournal(journal.idJournal)}"
								update=":#{p:component('journalTable')}">
						<p:confirm header="Delete this journal" 
								 message="Are you sure you want to delete this Journal: #{journal.name}, and all its publications?" 
								 icon="ui-icon-alert"/>
						<span class="glyphicon glyphicon-trash"></span>
					</p:commandLink>
				</p>
			</p:column>
		</p:dataTable>

		<p:dialog header="Edit the journal" id="dlgEdit" widgetVar="dlgEdit"
				fitViewport="true" modal="true" closeOnEscape="true">
			<p:ajax event="close" listener="#{listaRegistroBonosView.cancelarModificacion}" update="@this" />
			<h:form class="form-horizontal">
				<div class="modal-body">
					<fieldset>
						<div class="form-group">
							<p:outputLabel for="name" value="Journal Name:" styleClass="col-md-4 control-label"/>
							<div class="col-md-8">
								<p:inputText id="name" styleClass="form-control" pt:placeholder="Journal Name"
										   pt:required="true" maxlength="45" required="true"
										   value="#{journalsView.currentJournal.name}"/>
							</div>
						</div>
						<div class="form-group">
							<p:outputLabel for="tag" value="Tag:" styleClass="col-md-4 control-label"/>
							<div class="col-md-8">
								<p:inputText id="tag" styleClass="form-control" pt:placeholder="Tag"
										   maxlength="200"
										   value="#{journalsView.currentJournal.tags}"/>
							</div>
						</div>
						<div class="form-group">
							<p:outputLabel for="about" value="About:" styleClass="col-md-4 control-label"/>
							<div class="col-md-8">

								<p:inputTextarea id="about" styleClass="form-control"
											  rows="4" cols="50" counter="display" maxlength="200" 
											  counterTemplate="{0} characters remaining." autoResize="false" 
											  value="#{journalsView.currentJournal.about}"/>
								<h:outputText id="display" />
							</div>
						</div>
					</fieldset>
				</div>
				<div class="modal-footer ">
					<p:commandLink styleClass="btn btn-warning btn-lg" style="width: 100%;"
								update="@form,:#{p:component('journalTable')}" 
								actionListener="#{journalsView.saveChanges('dlgEdit')}">
						<span class="glyphicon glyphicon-ok-sign"></span> Save
					</p:commandLink>
				</div>
			</h:form>
		</p:dialog> 

		<p:confirmDialog global="true">
			<div class="pull-right">
				<p:commandLink styleClass="btn btn-success ui-confirmdialog-yes">
					<span class="glyphicon glyphicon-ok-sign"></span> Yes
				</p:commandLink>
				<p:commandLink styleClass="btn btn-default ui-confirmdialog-no">
					<span class="glyphicon glyphicon-remove"></span> No
				</p:commandLink>
			</div>
		</p:confirmDialog>
	</ui:define>

</ui:composition>
